import { ObjectId } from 'mongodb';
import { OpenaiChatbotService } from './openaiChatbotService';
import { TestBed } from '@automock/jest';
import { ChunkStatus, DataStoreType } from '../knowledgebase.schema';
import { PromptService } from '../prompt/prompt.service';
import { OpenaiService } from '../../openai/openai.service';

const LIGHTGALLERY_CONTEXT_FAIL = [
  `Video gallery - lightGallery: lightGallery supports YouTube, Vimeo, Wistia and all other type s of HTML5 video formats. Such as MP4, WebM, Ogg, etc.\n#### External videos\nTo display YouTube, Vimeo and Wistia, videos, you just need to paste the video URL, or share URL of the video in the data-src attribute.  The same way you display images in the gallery. lightGallery will check the data-src attribute and if it is a video URL, it will create the respective video slide.\nYou can also provide poster image for each video s. Poster images will be loaded instead of videos. So user will be able to navigate to other slides by using mouse drag or swipe. Poster images improve performance, and maintain the flexibility of your gallery with out effecting user experience. Videos will be loaded when a user clicks on the poster images. You can place poster image url in the data-poster attribute.\nlightGallery allows you to load thumbnail images automatic ally from YouTube and Vimeo. You can specify the size of the thumbnails in the settings. You need to use [Vimeo thumbnail plugin](/docs/settings/#vimeo-thumbnails-plugin) to load thumbnails for vimeo videos. Videos will be automatically paused when a user starts to navigate to another slide.\n#### HTML5 videos\nFor displaying HTML5 videos, you need to construct an object with array of video sources and types, and videos attr ibutes objects as shown below and pass it via data-video attribute\nNote - data-src should not be provided when you use html5 videos\n&#x60;&#x60;&#x60;\n{\n    source: [\n        {\n            src: &#x27;/videos/ video1.mp4&#x27;,\n            type: &#x27;video/mp4&#x27;,\n        },\n        ...\n    ],\n    // Optional video tracks - https://developer.mozilla.org/en-US/docs/Web/HTML/Element/track\n    tracks : [\n {\n            src: &#x27;/videos/title.txt&#x27;,\n            kind:&#x27;captions&#x27;\n        }\n    ],\n    attributes: { preload: false, controls: true },\n};\n&#x60;&#x60;&#x60;\n##### HTML structure\n&#x60 ;&#x60;&#x60;\n&lt;div id&#x3D;&quot;gallery-videos-demo&quot;&gt;\n    &lt;!-- YouTube Video ---&gt;\n    &lt;a\n        data-lg-size&#x3D;&quot;1280-720&quot;\n        data-src&#x3D;&quot;//www.youtube.com/watch?  v&#x3D;EIUJfXk3_3w&quot;\n        data-poster&#x3D;&quot;https://img.youtube.com/vi/EIUJfXk3_3w/maxresdefault.jpg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;Puffin Hunts Fish To Feed Puffling | Blue Planet I I | BBC Earth&lt;/h4&gt;&lt;p&gt;On the heels of Planet Earth II&#x27;s record-breaking Emmy nominations, BBC America presents stunning visual soundscapes from the series&#x27; amazing habitats.&lt;/p&gt;&quot;\n &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quot;https://img.youtube.com/vi/EIU JfXk3_3w/maxresdefault.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n    &lt;!-- Vimeo Video ---&gt;\n    &lt;a\n        data-lg-size&#x3D;&quot;1280-720&quot;\n        data-src&#x3D;&quot;//vimeo.com/112836958&quot;\n data-poster&#x3D;&quot;/images/demo/vimeo-video-poster.jpg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;Nature&lt;/h4&gt;&lt;p&gt;Video by &lt;a target&#x3D;&#x27;_blank&#x27; href&#x3D;&#x27;https://v imeo.com/charliekaye&#x27;&gt;Charlie Kaye&lt;/a&gt;&lt;/p&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-res ponsive&quot;\n            src&#x3D;&quot;/images/demo/vimeo-video-poster.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n    &lt;!-- Wistia Video ---&gt;\n    &lt;a\n        data-lg-size&#x3D;&quot;1280-720&quot;\n data-src&#x3D;&quot;https://private-sharing.wistia.com/medias/mwhrulrucj&quot;\n        data-poster&#x3D;&quot;/images/demo/wistia-video-poster.jpeg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;Thank You!&l t;/h4&gt;&lt;p&gt; Sample Wistia video &lt;/p&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&quot; \n            src&#x3D;&quot;/images/demo/wistia-video-poster.jpeg&quot;\n        /&gt;\n    &lt;/a&gt;\n    &lt;!-- HTML5 Video ---&gt;\n    &lt;a\n        data-lg-size&#x3D;&quot;1280-720&quot;\n        data-vide o&#x3D;&#x27;{&quot;source&quot;: [{&quot;src&quot;:&quot;/videos/video1.mp4&quot;, &quot;type&quot;:&quot;video/mp4&quot;}], &quot;tracks&quot;: [{&quot;src&quot;: &quot;{/videos/title.txt&quot;, &quot;kind&quot;: &quot;captions&quot;, &quot;srclang&quot;: &quot;en&quot;, &quot;label&quot;: &quot;English&quot;, &quot;default&quot;: &quot;true&quot;}], &quot;attributes&quot;: {&quot;preload&quot;: false, &quot;playsinline&quo t;: true, &quot;controls&quot;: true}}&#x27;\n        data-poster&#x3D;&quot;/images/demo/youtube-video-poster.jpg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;&#x27;Peck Pocketed&#x27; by Kevin Herron | Disne y Favorite&lt;/h4&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quot ;/images/demo/youtube-video-poster.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n&lt;/div&gt;\n&#x60;&#x60;&#x60;\n##### JavaScript\n&#x60;&#x60;&#x60;\nlightGallery(document.getElementById(&#x27;gallery-videos-demo&#x 27;), {\n    plugins: [lgVideo],\n});\n&#x60;&#x60;&#x60;\n#### Videojs example\n[Video.js](https://videojs.com/) is a web video player built from the ground up for an HTML5 world. lightGallery has inbuilt Video.js Support. To enable videojs in lightGallery you just need to pass &#x60;videojs&#x60;: &#x60;true&#x60; via lightGallery settings. You can also pass the videojs options via &#x60;videojsOptions&#x60;\nNote - Make s ure that you pass proper JSON object in data-video attribute\n##### Demo\n ![](https://www.lightgalleryjs.com/images/demo/html5-video-poster.jpg)![](https://www.lightgalleryjs.com/images/demo/html5-video-poster-2.j pg)\n##### HTML structure\n&#x60;&#x60;&#x60;\n&lt;div id&#x3D;&quot;gallery-videojs-demo&quot;&gt;\n    &lt;a\n        data-lg-size&#x3D;&quot;1280-720&quot;\n        data-video&#x3D;&#x27;{&quot;source&quot;: [{& quot;src&quot;:&quot;/videos/video1.mp4&quot;, &quot;type&quot;:&quot;video/mp4&quot;}], &quot;attributes&quot;: {&quot;preload&quot;: false, &quot;controls&quot;: true}}&#x27;\n        data-poster&#x3D;&quot;/imag es/demo/youtube-video-poster.jpg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;&#x27;Peck Pocketed&#x27; by Kevin Herron | Disney Favorite&lt;/h4&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&qu ot;300&quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quot;/images/demo/youtube-video-poster.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n    .  ..\n&lt;/div&gt;\n&#x60;&#x60;&#x60;\n##### JavaScript\n&#x60;&#x60;&#x60;\nlightGallery(document.getElementById(&#x27;gallery-videojs-demo&#x27;), {\n    plugins: [lgVideo],\n    videojs: true,\n    videojsOptions : {\n        muted: true,\n    },\n});\n&#x60;&#x60;&#x60;\n#### Video Autoplay\nAutoplay might be blocked in some environments, such as IOS, Chrome 66+, and Safari 11+ due to their predefined auto-play policy.\nIt is dependent on [many scenarios](https://developer.chrome.com/blog/autoplay/). By default, lightGallery mute the video and enable autoplay for the first slide if it contains videos. Since version 2.3.0, lightGallery allows you to pass query parameters via YouTube or Vimeo videos. If you want, you can unmute the video by passing &#x60;?mute&#x3D;0&#x60; or &#x60;?muted&#x3D;false&#x60; respectively via video URL params\n; URL: https://www.lightgalleryjs.com/demos/video-gallery/`,
  `Video gallery - lightGallery: Also, [on IOS](https://stackoverflow.com/questions/43570460/html5-video-autoplay-on-iphone), you might need to set &#x60;&quot ;playsinline&quot;: true,&#x60; for HTML5 videos\n##### HTML structure\n&#x60;&#x60;&#x60;\n&lt;div id&#x3D;&quot;gallery-videojs-demo&quot;&gt;\n    &lt;!-- YouTube Video ---&gt;\n    &lt;a\n        data-lg-size&# x3D;&quot;1280-720&quot;\n        data-src&#x3D;&quot;//www.youtube.com/watch?v&#x3D;EIUJfXk3_3w&amp;mute&#x3D;0&quot;\n        data-poster&#x3D;&quot;https://img.youtube.com/vi/EIUJfXk3_3w/maxresdefault.jpg&quot;\\ n        data-sub-html&#x3D;&quot;&lt;h4&gt;Puffin Hunts Fish To Feed Puffling | Blue Planet II | BBC Earth&lt;/h4&gt;&lt;p&gt;On the heels of Planet Earth II&#x27;s record-breaking Emmy nominations, BBC America pr esents stunning visual soundscapes from the series&#x27; amazing habitats.&lt;/p&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n            cl ass&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quot;https://img.youtube.com/vi/EIUJfXk3_3w/maxresdefault.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n    &lt;!-- Vimeo Video ---&gt;\n    &lt;a\n        dat a-lg-size&#x3D;&quot;1280-720&quot;\n        data-src&#x3D;&quot;//vimeo.com/112836958?muted&#x3D;false&quot;\n        data-poster&#x3D;&quot;/images/demo/vimeo-video-poster.jpg&quot;\n        data-sub-html&#x3D;&q uot;&lt;h4&gt;Nature&lt;/h4&gt;&lt;p&gt;Video by &lt;a target&#x3D;&#x27;_blank&#x27; href&#x3D;&#x27;https://vimeo.com/charliekaye&#x27;&gt;Charlie Kaye&lt;/a&gt;&lt;/p&gt;&quot;\n    &gt;\n        &lt;img\n width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quot;/images/demo/vimeo-video-poster.jpg&quot;\n        /&gt;\n &lt;/a&gt;\n    &lt;!-- HTML5 videos --&gt;\n    &lt;a\n        data-lg-size&#x3D;&quot;1280-720&quot;\n        data-video&#x3D;&#x27;{&quot;source&quot;: [{&quot;src&quot;:&quot;/videos/video1.mp4&quot;, &quot;ty pe&quot;:&quot;video/mp4&quot;}], &quot;attributes&quot;: {&quot;preload&quot;: false, &quot;playsinline&quot;: true, &quot;controls&quot;: true}}&#x27;\n        data-poster&#x3D;&quot;/images/demo/youtube-video-po ster.jpg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;&#x27;Peck Pocketed&#x27; by Kevin Herron | Disney Favorite&lt;/h4&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quot;/images/demo/youtube-video-poster.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n    ...\n&lt;/div&gt;\n&#x60; &#x60;&#x60;\n[Edit this page on GitHub](https://github.com/sachinchoolur/lightGallery/tree/master/site/content/demos/video-gallery.md)\n; URL: https://www.lightgalleryjs.com/demos/video-gallery/`,
  `Mixed contents - lightGallery: lightGallery supports, images, HTML5 videos, external videos such as YouTube, Vimeo videos and iframes. You can mix all types of supported contents in a same gallery. lightGallery will automatically find the content type from source and create appropriate slides\n#### Demo\n##### HTML Structure\n&#x60;&#x60;&#x60;\n&lt;div id&#x3D;&quot;gallery-mixed-content-demo&quot;&gt;\n    &lt;!-- Image --&gt;\n    &lt;a href&#x3D;&quot;img/img1.jpg&quot;&gt;\n        &lt;img src&#x3D;&quot;img/thumb1.jpg&quot; /&gt;\n    &lt;/a&gt;\n    &lt;!-- YouTube Video ---&gt;\n    &lt;a\n        data-lg-size&#x3D;&quot;1280-720&quot;\n data-src&#x3D;&quot;//www.youtube.com/watch?v&#x3D;EIUJfXk3_3w&quot;\n        data-poster&#x3D;&quot;https://img.youtube.com/vi/EIUJfXk3_3w/maxresdefault.jpg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;Pu ffin Hunts Fish To Feed Puffling | Blue Planet II | BBC Earth&lt;/h4&gt;&lt;p&gt;On the heels of Planet Earth II&#x27;s record-breaking Emmy nominations, BBC America presents stunning visual soundscapes from the se ries&#x27; amazing habitats.&lt;/p&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&quot;\n src&#x3D;&quot;https://img.youtube.com/vi/EIUJfXk3_3w/maxresdefault.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n    &lt;!-- VImeo Video ---&gt;\n    &lt;a\n        data-lg-size&#x3D;&quot;1280-720&quot;\n        d ata-src&#x3D;&quot;//vimeo.com/112836958&quot;\n        data-poster&#x3D;&quot;/images/demo/vimeo-video-poster.jpg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;Nature&lt;/h4&gt;&lt;p&gt;Video by &lt;a target&# x3D;&#x27;_blank&#x27; href&#x3D;&#x27;https://vimeo.com/charliekaye&#x27;&gt;Charlie Kaye&lt;/a&gt;&lt;/p&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot ;100&quot;\n            class&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quot;/images/demo/vimeo-video-poster.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n    &lt;!-- Wistia Video ---&gt;\n    &lt;a\n data-lg-size&#x3D;&quot;1280-720&quot;\n        data-src&#x3D;&quot;https://private-sharing.wistia.com/medias/mwhrulrucj&quot;\n        data-poster&#x3D;&quot;/images/demo/wistia-video-poster.jpeg&quot;\n data-sub-html&#x3D;&quot;&lt;h4&gt;Thank You!&lt;/h4&gt;&lt;p&gt; Sample Wistia video &lt;/p&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n class&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quot;/images/demo/wistia-video-poster.jpeg&quot;\n        /&gt;\n    &lt;/a&gt;\n    &lt;!-- HTML5 Video ---&gt;\n    &lt;a\n        data-lg-s ize&#x3D;&quot;1280-720&quot;\n        data-video&#x3D;&#x27;{&quot;source&quot;: [{&quot;src&quot;:&quot;/videos/video1.mp4&quot;, &quot;type&quot;:&quot;video/mp4&quot;}], &quot;attributes&quot;: {&quot;preload&q uot;: false, &quot;controls&quot;: true}}&#x27;\n        data-poster&#x3D;&quot;/images/demo/html5-video-poster.jpg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;&#x27;Peck Pocketed&#x27; by Kevin Herron | Disn ey Favorite&lt;/h4&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quo t;/images/demo/html5-video-poster.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n&lt;/div&gt;\n&#x60;&#x60;&#x60;\n##### JavaScript\n&#x60;&#x60;&#x60;\nlightGallery(document.getElementById(&#x27;gallery-mixed-content-d emo&#x27;));\n&#x60;&#x60;&#x60;\n[Edit this page on GitHub](https://github.com/sachinchoolur/lightGallery/tree/master/site/content/demos/mixed-contents.md)\n; URL: https://www.lightgalleryjs.com/demos/mixed-contents/`,
];

const LIGHTGALLERY_CONTEXT_SUCCESS = [
  `Custom work - lightGallery: One of the main benefits of using lightGallery is the ability to build galleries based on your unique requirements. It is easy to add new features or customize the existing functionalities.\nIf you need any help with customizing lightGallery, adding new features, create a new pl ugin, or need any other assistance that is beyond the scope of regular support, reach out to [contact@lightgalleryjs.com](mailto:contact@lightgalleryjs.com) with your requirements. We’ll help you if we can or at le ast point you in the right direction.\n[Edit this page on GitHub](https://github.com/sachinchoolur/lightGallery/tree/master/site/content/docs/custom-work.md)\n; URL: https://www.lightgalleryjs.com/docs/custom-work/`,
  `Video gallery - lightGallery: lightGallery supports YouTube, Vimeo, Wistia and all other types of HTML5 video formats. Such as MP4, WebM, Ogg, etc.\n#### External videos\nTo display YouTube, Vimeo and Wistia, v ideos, you just need to paste the video URL, or share URL of the video in the data-src attribute. The same way you display images in the gallery. lightGallery will check the data-src attribute and if it is a video URL, it will create the respective video slide.\nYou can also provide poster image for each videos. Poster images will be loaded instead of videos. So user will be able to navigate to other slides by using mouse dr ag or swipe. Poster images improve performance, and maintain the flexibility of your gallery without effecting user experience. Videos will be loaded when a user clicks on the poster images. You can place poster im age url in the data-poster attribute.\nlightGallery allows you to load thumbnail images automatically from YouTube and Vimeo. You can specify the size of the thumbnails in the settings. You need to use [Vimeo thumb nail plugin](/docs/settings/#vimeo-thumbnails-plugin) to load thumbnails for vimeo videos. Videos will be automatically paused when a user starts to navigate to another slide.\n#### HTML5 videos\nFor displaying HTM L5 videos, you need to construct an object with array of video sources and types, and videos attributes objects as shown below and pass it via data-video attribute\nNote - data-src should not be provided when you u se html5 videos\n&#x60;&#x60;&#x60;\n{\n    source: [\n        {\n            src: &#x27;/videos/video1.mp4&#x27;,\n            type: &#x27;video/mp4&#x27;,\n        },\n        ...\n    ],\n    // Optional video t racks - https://developer.mozilla.org/en-US/docs/Web/HTML/Element/track\n    tracks : [\n        {\n            src: &#x27;/videos/title.txt&#x27;,\n            kind:&#x27;captions&#x27;\n        }\n    ],\n    att ributes: { preload: false, controls: true },\n};\n&#x60;&#x60;&#x60;\n##### HTML structure\n&#x60;&#x60;&#x60;\n&lt;div id&#x3D;&quot;gallery-videos-demo&quot;&gt;\n    &lt;!-- YouTube Video ---&gt;\n    &lt;a\n data-lg-size&#x3D;&quot;1280-720&quot;\n        data-src&#x3D;&quot;//www.youtube.com/watch?v&#x3D;EIUJfXk3_3w&quot;\n        data-poster&#x3D;&quot;https://img.youtube.com/vi/EIUJfXk3_3w/maxresdefault.jpg&quo t;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;Puffin Hunts Fish To Feed Puffling | Blue Planet II | BBC Earth&lt;/h4&gt;&lt;p&gt;On the heels of Planet Earth II&#x27;s record-breaking Emmy nominations, BBC America presents stunning visual soundscapes from the series&#x27; amazing habitats.&lt;/p&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n class&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quot;https://img.youtube.com/vi/EIUJfXk3_3w/maxresdefault.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n    &lt;!-- Vimeo Video ---&gt;\n    &lt;a\n data-lg-size&#x3D;&quot;1280-720&quot;\n        data-src&#x3D;&quot;//vimeo.com/112836958&quot;\n        data-poster&#x3D;&quot;/images/demo/vimeo-video-poster.jpg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt; Nature&lt;/h4&gt;&lt;p&gt;Video by &lt;a target&#x3D;&#x27;_blank&#x27; href&#x3D;&#x27;https://vimeo.com/charliekaye&#x27;&gt;Charlie Kaye&lt;/a&gt;&lt;/p&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x 3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quot;/images/demo/vimeo-video-poster.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n &lt;!-- Wistia Video ---&gt;\n    &lt;a\n        data-lg-size&#x3D;&quot;1280-720&quot;\n        data-src&#x3D;&quot;https://private-sharing.wistia.com/medias/mwhrulrucj&quot;\n        data-poster&#x3D;&quot;/im ages/demo/wistia-video-poster.jpeg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;Thank You!&lt;/h4&gt;&lt;p&gt; Sample Wistia video &lt;/p&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300& quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quot;/images/demo/wistia-video-poster.jpeg&quot;\n        /&gt;\n    &lt;/a&gt;\n    &lt;!-- HTML5 Video ---&gt;\n    &lt;a\n        data-lg-size&#x3D;&quot;1280-720&quot;\n        data-video&#x3D;&#x27;{&quot;source&quot;: [{&quot;src&quot;:&quot;/videos/video1.mp4&quot;, &quot;type&quot;:&quot;video/mp4& quot;}], &quot;tracks&quot;: [{&quot;src&quot;: &quot;{/videos/title.txt&quot;, &quot;kind&quot;:&quot;captions&quot;, &quot;srclang&quot;: &quot;en&quot;, &quot;label&quot;: &quot;English&quot;, &quot;default&quot ;: &quot;true&quot;}], &quot;attributes&quot;: {&quot;preload&quot;: false, &quot;playsinline&quot;: true, &quot;controls&quot;: true}}&#x27;\n        data-poster&#x3D;&quot;/images/demo/youtube-video-poster.jpg&qu ot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;&#x27;Peck Pocketed&#x27; by Kevin Herron | Disney Favorite&lt;/h4&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x 3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quot;/images/demo/youtube-video-poster.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n&lt;/div&gt;\n&#x60;&#x60;&#x60;\n##### JavaScript\n&#x60;&#x60;&#x60;\nlightGallery(document.getElementById(&#x27;gallery-videos-demo&#x27;), {\n    plugins: [lgVideo],\n});\n&#x60;&#x60;&#x60;\n#### Videojs example\n[Video.js](https://videojs.com/) is a web video player built from the ground up for an HTML5 world. lightGallery has inbuilt Video.js Support. To enable videojs in lightGallery you just need to pass &#x60;videojs&#x60;: &#x60;true&#x60; via lightGall ery settings. You can also pass the videojs options via &#x60;videojsOptions&#x60;\nNote - Make sure that you pass proper JSON object in data-video attribute\n##### Demo\n ![](https://www.lightgalleryjs.com/images/ demo/html5-video-poster.jpg)![](https://www.lightgalleryjs.com/images/demo/html5-video-poster-2.jpg)\n##### HTML structure\n&#x60;&#x60;&#x60;\n&lt;div id&#x3D;&quot;gallery-videojs-demo&quot;&gt;\n    &lt;a\n data-lg-size&#x3D;&quot;1280-720&quot;\n        data-video&#x3D;&#x27;{&quot;source&quot;: [{&quot;src&quot;:&quot;/videos/video1.mp4&quot;, &quot;type&quot;:&quot;video/mp4&quot;}], &quot;attributes&quot;: {&qu ot;preload&quot;: false, &quot;controls&quot;: true}}&#x27;\n        data-poster&#x3D;&quot;/images/demo/youtube-video-poster.jpg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;&#x27;Peck Pocketed&#x27; by Kevin Herron | Disney Favorite&lt;/h4&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&quot;\n src&#x3D;&quot;/images/demo/youtube-video-poster.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n    ...\n&lt;/div&gt;\n&#x60;&#x60;&#x60;\n##### JavaScript\n&#x60;&#x60;&#x60;\nlightGallery(document.getElementById(&#x2 7;gallery-videojs-demo&#x27;), {\n    plugins: [lgVideo],\n    videojs: true,\n    videojsOptions: {\n        muted: true,\n    },\n});\n&#x60;&#x60;&#x60;\n#### Video Autoplay\nAutoplay might be blocked in some en vironments, such as IOS, Chrome 66+, and Safari 11+ due to their predefined auto-play policy.\nIt is dependent on [many scenarios](https://developer.chrome.com/blog/autoplay/). By default, lightGallery mute the vid eo and enable autoplay for the first slide if it contains videos. Since version 2.3.0, lightGallery allows you to pass query parameters via YouTube or Vimeo videos. If you want, you can unmute the video by passing &#x60;?mute&#x3D;0&#x60; or &#x60;?muted&#x3D;false&#x60; respectively via video URL params\n; URL: https://www.lightgalleryjs.com/demos/video-gallery/`,
  `Mixed contents - lightGallery: lightGallery supports, image s, HTML5 videos, external videos such as YouTube, Vimeo videos and iframes. You can mix all types of supported contents in a same gallery. lightGallery will automatically find the content type from source and creat e appropriate slides\n#### Demo\n##### HTML Structure\n&#x60;&#x60;&#x60;\n&lt;div id&#x3D;&quot;gallery-mixed-content-demo&quot;&gt;\n    &lt;!-- Image --&gt;\n    &lt;a href&#x3D;&quot;img/img1.jpg&quot;&gt;\n &lt;img src&#x3D;&quot;img/thumb1.jpg&quot; /&gt;\n    &lt;/a&gt;\n    &lt;!-- YouTube Video ---&gt;\n    &lt;a\n        data-lg-size&#x3D;&quot;1280-720&quot;\n        data-src&#x3D;&quot;//www.youtube.com/wa tch?v&#x3D;EIUJfXk3_3w&quot;\n        data-poster&#x3D;&quot;https://img.youtube.com/vi/EIUJfXk3_3w/maxresdefault.jpg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;Puffin Hunts Fish To Feed Puffling | Blue Plan et II | BBC Earth&lt;/h4&gt;&lt;p&gt;On the heels of Planet Earth II&#x27;s record-breaking Emmy nominations, BBC America presents stunning visual soundscapes from the series&#x27; amazing habitats.&lt;/p&gt;&quot; \n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quot;https://img.youtube.com/vi /EIUJfXk3_3w/maxresdefault.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n    &lt;!-- VImeo Video ---&gt;\n    &lt;a\n        data-lg-size&#x3D;&quot;1280-720&quot;\n        data-src&#x3D;&quot;//vimeo.com/112836958&quo t;\n        data-poster&#x3D;&quot;/images/demo/vimeo-video-poster.jpg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;Nature&lt;/h4&gt;&lt;p&gt;Video by &lt;a target&#x3D;&#x27;_blank&#x27; href&#x3D;&#x27;https ://vimeo.com/charliekaye&#x27;&gt;Charlie Kaye&lt;/a&gt;&lt;/p&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img -responsive&quot;\n            src&#x3D;&quot;/images/demo/vimeo-video-poster.jpg&quot;\n        /&gt;\n    &lt;/a&gt;\n    &lt;!-- Wistia Video ---&gt;\n    &lt;a\n        data-lg-size&#x3D;&quot;1280-720&quot;\n data-src&#x3D;&quot;https://private-sharing.wistia.com/medias/mwhrulrucj&quot;\n        data-poster&#x3D;&quot;/images/demo/wistia-video-poster.jpeg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;Thank Yo u!&lt;/h4&gt;&lt;p&gt; Sample Wistia video &lt;/p&gt;&quot;\n    &gt;\n        &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&q uot;\n            src&#x3D;&quot;/images/demo/wistia-video-poster.jpeg&quot;\n        /&gt;\n    &lt;/a&gt;\n    &lt;!-- HTML5 Video ---&gt;\n    &lt;a\n        data-lg-size&#x3D;&quot;1280-720&quot;\n        data- video&#x3D;&#x27;{&quot;source&quot;: [{&quot;src&quot;:&quot;/videos/video1.mp4&quot;, &quot;type&quot;:&quot;video/mp4&quot;}], &quot;attributes&quot;: {&quot;preload&quot;: false, &quot;controls&quot;: true}}&#x 27;\n        data-poster&#x3D;&quot;/images/demo/html5-video-poster.jpg&quot;\n        data-sub-html&#x3D;&quot;&lt;h4&gt;&#x27;Peck Pocketed&#x27; by Kevin Herron | Disney Favorite&lt;/h4&gt;&quot;\n    &gt;\n &lt;img\n            width&#x3D;&quot;300&quot;\n            height&#x3D;&quot;100&quot;\n            class&#x3D;&quot;img-responsive&quot;\n            src&#x3D;&quot;/images/demo/html5-video-poster.jpg&quot;\\ n        /&gt;\n    &lt;/a&gt;\n&lt;/div&gt;\n&#x60;&#x60;&#x60;\n##### JavaScript\n&#x60;&#x60;&#x60;\nlightGallery(document.getElementById(&#x27;gallery-mixed-content-demo&#x27;));\n&#x60;&#x60;&#x60;\n[Edit this page on GitHub](https://github.com/sachinchoolur/lightGallery/tree/master/site/content/demos/mixed-contents.md)\n; URL: https://www.lightgalleryjs.com/demos/mixed-contents/`,
];

const TOKEN_TEXT_423 =
  'Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur? But I must explain to you how all this mistaken idea of denouncing pleasure and praising pain was born and I will give you a complete account of the system, and expound the actual teachings of the great explorer of the truth, the master-builder of human happiness. No one rejects, dislikes, or avoids pleasure itself, because it is pleasure, but because those who do not know how to pursue pleasure rationally encounter consequences that are extremely painful. Nor again is there anyone who loves or pursues or desires to obtain pain of itself, because it is pain, but because occasionally circumstances occur in which toil and pain can procure him some great pleasure. To take a trivial example, which of us ever undertakes laborious physical exercise, except to obtain some advantage from it? But who has any right to find fault with a man who chooses to enjoy a pleasure that has no annoying consequences, or one who avoids a pain that produces no resultant pleasure?';

const getTokenCount = new OpenaiService({ get: () => 'hi' } as any)
  .getTokenCount;

describe('getChatGptPrompt', () => {
  let openaiCbService: OpenaiChatbotService;

  beforeEach(() => {
    const { unit, unitRef } = TestBed.create(OpenaiChatbotService).compile();
    openaiCbService = unit;
    const promptServiceMock: jest.Mocked<PromptService> =
      unitRef.get(PromptService);
    promptServiceMock.compilePrompt.mockImplementation(
      new PromptService({} as any).compilePrompt,
    );
    unitRef.get(OpenaiService).getTokenCount.mockImplementation(getTokenCount);
  });

  it('should not execeed token limit', () => {
    const prompt = openaiCbService.getChatGptPrompt(
      'Test Chatbot',
      'what is your name',
      LIGHTGALLERY_CONTEXT_FAIL.map((c) => ({
        chunk: 'a',
        content: c,
        dataStoreId: new ObjectId(),
        knowledgebaseId: new ObjectId(),
        score: 0.9,
        status: ChunkStatus.CREATED,
        type: DataStoreType.WEBPAGE,
        createdAt: new Date(),
        updatedAt: new Date(),
      })),
      [
        {
          q: TOKEN_TEXT_423,
          a: TOKEN_TEXT_423,
          qTokens: 423,
          aTokens: 423,
          ts: new Date(),
        },
        {
          q: 'hi',
          a: TOKEN_TEXT_423,
          qTokens: 1,
          aTokens: 200,
          ts: new Date(),
        },
      ],
      undefined,
      undefined,
      4000,
    );

    expect(
      openaiCbService.getTokenCountForChatGptMessages(prompt),
    ).toBeLessThan(4000);
  });
});
